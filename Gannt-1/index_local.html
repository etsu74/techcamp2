<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マンション修繕計画ガントチャート</title>
    <link rel="icon" href="data:," />
    
    <!-- Frappe Gantt CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
    
    <!-- カスタムCSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/gantt.css">
    <link rel="stylesheet" href="css/footer-fix.css">
</head>
<body>
    <!-- ヘッダー部 -->
    <header class="app-header">
        <div class="header-container">
            <h1 class="app-title">マンション修繕計画ガントチャート</h1>
            <div class="header-controls">
                <!-- 表示切替ボタン -->
                <div class="view-mode-buttons">
                    <button id="btn-day" class="view-btn">日</button>
                    <button id="btn-week" class="view-btn">週</button>
                    <button id="btn-month" class="view-btn active">月</button>
                    <button id="btn-year" class="view-btn">年</button>
                </div>
                
                <!-- 編集ボタン（MVP段階ではモック） -->
                <div class="edit-buttons">
                    <button id="btn-add-event" class="edit-btn" disabled>イベント追加</button>
                    <button id="btn-edit-meeting" class="edit-btn" disabled>会議設定</button>
                </div>
            </div>
        </div>
    </header>

    <!-- メイン部 -->
    <main class="app-main">
        <div class="main-container">
            <!-- 左カラム: イベント名（固定表示） -->
            <div class="left-panel">
                <div class="panel-header">
                    <h3>イベント名</h3>
                </div>
                <div id="event-list" class="event-list">
                    <!-- JavaScriptで動的生成 -->
                </div>
            </div>

            <!-- 右カラム: ガントチャート（横スクロール対応） -->
            <div class="right-panel">
                <div id="gantt-container" class="gantt-container">
                    <!-- Frappe Ganttが挿入される -->
                </div>
            </div>
        </div>
    </main>

    <!-- フッター部 -->
    <footer class="app-footer">
        <div class="footer-container">
            <!-- ファイル操作部 -->
            <div class="file-operations">
                <!-- インポート -->
                <div class="import-section">
                    <div id="drop-area" class="drop-area">
                        <p>ファイルをドロップまたはクリックしてアップロード</p>
                        <input type="file" id="file-input" accept=".csv,.xlsx,.xls" />
                    </div>
                </div>
                
                <!-- エクスポート -->
                <div class="export-section">
                    <button id="btn-export-excel" class="export-btn">Excel出力</button>
                    <button id="btn-load-demo" class="demo-btn">サンプル読込</button>
                </div>
            </div>
            
            <!-- ステータス表示部 -->
            <div class="status-section">
                <div id="data-count" class="data-count">
                    工事: 0件 | 会議: 0件
                </div>
                <div id="status" class="status-message">
                    準備完了 - ファイルをアップロードしてください
                </div>
            </div>
        </div>
    </footer>

    <!-- ポップアップモーダル -->
    <div id="event-popup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="popup-header">
                <h3 id="popup-title">イベント詳細</h3>
                <button class="popup-close" onclick="closePopup()">&times;</button>
            </div>
            <div class="popup-body">
                <div id="popup-details"></div>
                <div class="memo-section">
                    <label for="memo-input">メモ:</label>
                    <textarea id="memo-input" rows="3" placeholder="メモを入力してください..."></textarea>
                    <button id="memo-save" class="memo-save-btn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Frappe Gantt JS -->
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.umd.js"></script>
    
    <!-- SheetJS for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- カスタムJS -->
    <script src="js/error-handler.js"></script>
    <script src="js/data-processor.js"></script>
    <script src="js/gantt-manager.js"></script>

    <!-- インラインサンプルデータ for ローカル版 -->
    <script>
        // ローカル版用：インラインCSVデータ
        const DEMO_CSV_DATA = `id,name,start,end,progress,dependencies,assignee,event_type,organization_level,organization_type,decision_authority,report_to,attendees,location,agenda,timeline_color,priority,frequency,memo
T1,補助金申請,2026-04-15,2026-06-30,0,,担当2,construction,,,,,,,,,,,申請手続き詳細
T2,コンセプト,2024-11-15,2024-12-31,100,,担当3,construction,,,,,,,,,,,基本方針策定
T3,設計契約締結,2025-01-15,2025-01-31,100,T2,担当4,construction,,,,,,,,,,,RC1決議に基づく契約
T4,基本計画,2025-03-01,2025-05-31,100,T3,担当4,construction,,,,,,,,,,,
T5,基本設計,2025-07-01,2025-09-30,10,,担当5,construction,,,,,,,,,,,
GM1,年次総会,2025-06-15,2025-06-15,100,,理事長,meeting,1,general_meeting,final,,全組合員,集会所,年度決算・大規模修繕承認,#8B0000,critical,annual,重要決議事項
GM2,臨時総会,2025-09-10,2025-09-10,100,,理事長,meeting,1,general_meeting,final,,全組合員,集会所,修繕工事予算追加承認,#8B0000,critical,adhoc,追加予算承認
BM1,理事会定例会1月,2025-01-20,2025-01-20,100,,理事会,meeting,2,board_meeting,executive,GM1,理事5名,管理室,月次運営報告・修繕委員会設置,#FF8C00,high,monthly,委員会設置決議
BM2,理事会定例会2月,2025-02-20,2025-02-20,100,,理事会,meeting,2,board_meeting,executive,GM1,理事5名,管理室,修繕委員会進捗確認,#FF8C00,high,monthly,
BM3,理事会定例会3月,2025-03-20,2025-03-20,100,,理事会,meeting,2,board_meeting,executive,GM1,理事5名,管理室,基本設計承認,#FF8C00,high,monthly,
RC1,修繕委員会1月,2025-01-25,2025-01-25,100,,修繕委員会,meeting,3,repair_committee,advisory,BM1,委員3名・設計者,会議室A,基本設計検討,#32CD32,high,monthly,設計方針決定
RC2,修繕委員会2月,2025-02-05,2025-02-05,100,,修繕委員会,meeting,3,repair_committee,advisory,BM2,委員3名・設計者,会議室A,基本設計詳細協議,#32CD32,high,monthly,
T6,設計者予算算出,2025-10-01,2025-11-15,0,,担当1,construction,,,,,,,,,,,
T7,実施設計,2026-01-01,2026-04-30,0,T5,担当2,construction,,,,,,,,,,,
T8,設計者予算算出2,2026-05-01,2026-06-15,0,,担当3,construction,,,,,,,,,,,`;
    </script>
    
    <!-- ローカル版用main.js -->
    <script src="js/main_local.js"></script>
</body>
</html>